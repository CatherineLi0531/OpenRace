<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/OpenRace/blog/rss.xml" title="Coderrect OpenRace Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/OpenRace/blog/atom.xml" title="Coderrect OpenRace Blog Atom Feed"><title data-react-helmet="true">Pointer Analysis Architecture | Coderrect OpenRace</title><meta data-react-helmet="true" property="og:url" content="https://coderrect-inc.github.io/OpenRace/doc-pta-arch"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Pointer Analysis Architecture | Coderrect OpenRace"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="shortcut icon" href="/OpenRace/img/coderrect-logo.png"><link data-react-helmet="true" rel="canonical" href="https://coderrect-inc.github.io/OpenRace/doc-pta-arch"><link data-react-helmet="true" rel="alternate" href="https://coderrect-inc.github.io/OpenRace/doc-pta-arch" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://coderrect-inc.github.io/OpenRace/doc-pta-arch" hreflang="x-default"><link rel="stylesheet" href="/OpenRace/assets/css/styles.ed0b3173.css">
<link rel="preload" href="/OpenRace/assets/js/styles.e8a566df.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/runtime~main.ba43cde6.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/main.1a781497.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/1.1431b613.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/2.c28e7a27.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/3.f253f854.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/1be78505.ed6ce7d4.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/21.1345832e.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/935f2afb.fd86e8c5.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/17896441.811aa758.js" as="script">
<link rel="preload" href="/OpenRace/assets/js/60f5794e.a68d9df1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/OpenRace/"><img src="/OpenRace/img/coderrect-logo.png" alt="Coderrect OpenRace" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/OpenRace/img/coderrect-logo.png" alt="Coderrect OpenRace" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Coderrect OpenRace</strong></a><a href="https://coderrect.com/blog/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/coderrect-inc/OpenRace" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/OpenRace/"><img src="/OpenRace/img/coderrect-logo.png" alt="Coderrect OpenRace" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/OpenRace/img/coderrect-logo.png" alt="Coderrect OpenRace" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Coderrect OpenRace</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://coderrect.com/blog/" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/coderrect-inc/OpenRace" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/OpenRace/">Get Started with Coderrect OpenRace</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/OpenRace/doc-setup-dev-env">Setting Up Dev Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/OpenRace/doc-overview">Design Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/OpenRace/doc-adding-new-features">Adding New Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/OpenRace/doc-contribute-to-docs">Contribute to Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/OpenRace/doc-pta-arch">Pointer Analysis Architecture</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Pointer Analysis Architecture</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>The Pointer Analysis framework (under <code>src/PointerAnalysis</code>) in OpenRace
computes a set of object (<em>points-to set</em>) that can be pointed by a pointer
in the program during the runtime.
It implements a context-sensitive and field-sensitive inclusion-based (Andersen)
Pointer Analysis algorithm.  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="high-level-architecture"></a>High-Level Architecture<a class="hash-link" href="#high-level-architecture" title="Direct link to heading">#</a></h2><p>There are three major components in the pointer analysis framework and they
interact with each other to compute the final result.</p><p><img alt="PTA-arch" src="/OpenRace/assets/images/PTA-Overview-df6d2d0f826fcc2817f04691e406dcf2.svg"></p><p>These components communicated with each other through a set of pre-defined APIs in
<code>MemModelTrait</code> as well as in <code>LangModelTrait</code>.
At high level,
<strong>Language Model</strong> abstracts the target program into the <em>constraint graph</em>,
the pointer analysis framework offers the flexibility for user-defined language model to
intercept any function call in the program and handle it differently;
<strong>Memory Model</strong> handles the creation of the static objects, different memory models handles
object creation differently. E.g., Field-Insensitive Memory Model (<code>FIMemModel.h</code>) simply
creates one object node for the object while Field-Sensitive Memory Model (<code>FSMemModel.h</code>)
creates one object node for each field of the object.
Finally, <strong>Solver</strong> takes the constraint graph as the input and computes the final result.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="detailed-implementation"></a>Detailed Implementation<a class="hash-link" href="#detailed-implementation" title="Direct link to heading">#</a></h3><ol><li><strong>Language Model</strong>: Language Model transfers the program into the constraint graph/pointer assignment graph.<br>It creates pointer nodes (corresponding pointers in the program) and links nodes with different kinds of edges (corresponding to different operations performed in the program). There are five different kinds of edges in the constraint graph.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Constraints</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token base-clause">std</span><span class="token base-clause operator" style="color:rgb(137, 221, 255)">::</span><span class="token base-clause class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> copy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> addr_of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>load edge: <code>if ptr1 = *ptr2;, then ptr2 --load--&gt; ptr1</code> (ptr2 is loaded into ptr1).</li><li>store edge: <code>if *ptr1 = ptr2;, then ptr2 --store--&gt; ptr1</code> (ptr2 is stored into ptr1).</li><li>copy edge: <code>if ptr1 = ptr2;, then ptr2 --copy--&gt; ptr1</code> (ptr2 is copied to ptr1).</li><li>addr_of edge: <code>if ptr1 = &amp;ptr2; , then ptr2--addr_of--&gt; ptr1</code> (ptr1 takes the address of ptr2)</li><li>offset edge: <code>if ptr1 = ptr2-&gt;f;, then ptr2--offset--&gt;ptr1</code> (ptr1 add a offset to ptr2).</li></ul><ol start="2"><li><strong>Memory Model</strong>: Memory Model models the objects allocated in the program.
For example, it computes the size of each object, the memory layout of each object and it creates object nodes in the Constraint Graph.<br>Currently, we have two different memory models: </li></ol><ul><li><em>Field-insensitive memory model</em>: Field-insensitive memory model is a simple implementation of the memory model. It is relatively fast but also inaccurate. The field-insensitive memory model does not distinguish different fields of the object. For the following code snippet:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ptr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ptr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ptr1 and ptr2 are considered as alias when using field-insensitive memory</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// model, even though they point to different fields of the object.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">ALIAS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ptr1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ptr2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><em>Field-sensitive memory model</em>: Field-sensitive memory model (still in process) overcomes the limitations of the field-insensitive memory model. It distinguishes different fields of the same object so that the ptr1 and ptr2 in the above example are not considered as aliases. It computes the memory layout (the offset of each field)  and provides APIs to index into the complicated object to access the right fields.</li></ul><ol start="3"><li><strong>Andersen Solver</strong>: After the language model builds the constraint graph and memory model models the object, the pointer analysis uses the solver to computes the points-to set of the pointer. The detailed description of the algorithm can be found via <a href="http://compilers.cs.ucla.edu/fernando/publications/papers/CGO09.pdf" target="_blank" rel="noopener noreferrer">http://compilers.cs.ucla.edu/fernando/publications/papers/CGO09.pdf</a>.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="field-sensitivity"></a>Field-Sensitivity<a class="hash-link" href="#field-sensitivity" title="Direct link to heading">#</a></h3><p>Since the implementation of Field Sensitivity is complex, We provide some additional information in the documentation.</p><p>Field-sensitive pointer analysis is achieved by handling the offset constraints in the above table, at a high level,
the constraint <code>v &lt;- &amp;s.field</code> is satisfied by first index the object <code>s.field</code> and then add the address of <code>s.field</code> to the <code>pts(v)</code>.
<code>SolverBase.h: processOffset</code> implements the functionality.</p><p>For efficiency, the processOffset function maintains a cache (handledGEPMap) for GEP instructions to only handled diffed object indexing that havenâ€™t been handled before.<br>
The diffed object indexing is implementation as below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PtsTy </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">handled </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handledGEPMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">try_emplace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ptrNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">first</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">second</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> PtsTy </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">curPts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">PT</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getPointsTo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">src</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getNodeID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PtsTy newGEPs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">newGEPs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">intersectWithComplement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">curPts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> handled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// set intersect with complement</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>After the diffed points-to set is computed,  it iterate over the set using the following loop.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> objNode </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> nodeVec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this might create new object, thus modify the points-to set</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">fieldObj </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> llvm</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">cast_or_null</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ObjNodeTy</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">LMT</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">indexObject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getLangModel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> objNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fieldObj </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">nullptr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token keyword" style="font-style:italic">continue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token class-name" style="color:rgb(255, 203, 107)">PT</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">has</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ptrNode</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getNodeID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fieldObj</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getObjectID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token keyword" style="font-style:italic">this</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">consGraph</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">addConstraints</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fieldObj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ptrNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Constraints</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">addr_of</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token function" style="color:rgb(130, 170, 255)">callBack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fieldObj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ptrNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           changed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The fieldObject is computed by statement <code>LMT::indexObject(this-&gt;getLangModel(), objNode, gep)</code> which index the object.</p><p>The indexObject method is implemented differently when using different memory model, in FSMemModel, the code is available in <code>FSMemModel::indexObject()</code>
We implemented a different scheme than the traditional field-sensitive pointer analysis for C/C++ which uses logic field index to index the object.
Our implementation instead uses physical layout offset to index objects.</p><p>At a high level, FSMemModel computes a MemLayout for different types.
For example, suppose <code>sizeof(double *) == 4</code>, the memory layout for the following structure is a bitvector and is computed as below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">inner</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">double</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">double</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">outter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">inner</span><span class="token plain"> array_inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">double</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">  d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// memory layout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|1000 1000| 1000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|--array--| // mark the first 8 bytes (corresponding to array_inner) as array</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>FSMemModel::indexObject()</code> method indices the memory layout to test whether the bit is set in the memory layout and return the corresponding object at the offset as following</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> offset </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> llvm</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">APInt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getIndexTypeSizeInBits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">gep</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gep</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">accumulateConstantOffset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> obj</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">memBlock</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getObjectAt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">obj</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">pOffset </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getSExtValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It first use accumulate the offset of the gep by <code>gep-&gt;accumulateConstantOffset(DL, offset)</code> and then it index the object
using auto <code>result = obj-&gt;memBlock-&gt;getObjectAt(obj-&gt;pOffset + offset.getSExtValue())</code>.
If the supplied physical offset is invalid (can not be indexed), it returns <code>nullptr</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/coderrect-inc/OpenRace/tree/develop/website/docs/doc-pta-arch.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/OpenRace/doc-contribute-to-docs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Contribute to Docs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#high-level-architecture" class="table-of-contents__link">High-Level Architecture</a><ul><li><a href="#detailed-implementation" class="table-of-contents__link">Detailed Implementation</a></li><li><a href="#field-sensitivity" class="table-of-contents__link">Field-Sensitivity</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/OpenRace/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/OpenRace/doc-adding-new-features">Contributing</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/coderrect-inc/OpenRace" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://coderrect.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Coderrect, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/OpenRace/assets/js/styles.e8a566df.js"></script>
<script src="/OpenRace/assets/js/runtime~main.ba43cde6.js"></script>
<script src="/OpenRace/assets/js/main.1a781497.js"></script>
<script src="/OpenRace/assets/js/1.1431b613.js"></script>
<script src="/OpenRace/assets/js/2.c28e7a27.js"></script>
<script src="/OpenRace/assets/js/3.f253f854.js"></script>
<script src="/OpenRace/assets/js/1be78505.ed6ce7d4.js"></script>
<script src="/OpenRace/assets/js/21.1345832e.js"></script>
<script src="/OpenRace/assets/js/935f2afb.fd86e8c5.js"></script>
<script src="/OpenRace/assets/js/17896441.811aa758.js"></script>
<script src="/OpenRace/assets/js/60f5794e.a68d9df1.js"></script>
</body>
</html>